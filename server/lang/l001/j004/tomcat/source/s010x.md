#   主要问题

Tomcat 是一个Servlet容器，但是要支持HTTP协议，来实现对外接入。

Servlet容器和 HTTP 协议有什么关系吗? Java 可以实现 HTTP 协议，其他编程语言也可以，Java 有Servlet规范，其他语言也有相关技术。

HTTP协议可以由其他技术单独实现，作为通信手段单独存在，HTTP服务器就是，访问静态文件也可以啊。

Servlet 规范需要 Servlet 容器，Servlet 容器需要HTTP协议通信支持，正好，Java可以都实现，因此，Tomcat至少有两个部分：Servlet 引擎和HTTP协议实现，他们虽然是被拼接起来，但是，各司其职。

##  需求

Tomcat需要实现Java Web技术的规范，并随着规范升级而做出变更。

HTTP协议实现处理Socket连接，负责网络字节流与HttpRequest和HttpResponse对象的转化，另外还需要一个组件加载和管理Servlet，处理具体的逻辑即Servlet引擎。

Socket连接属于网络编程，Java有I/O模型实现，HTTP协议属于应用层协议，两者需要结合起来实现连接器，专门负责外部连接，对Servlet引擎屏蔽网络细节。

I/O模型和应用层协议并不是固定一对一的，而且在实际使用时需要灵活切换，两个都有可能随着版本升级增加或减少。

##  设计

Tomcat 的使用方式有两种，一是单独启动，二是内嵌到JAR包，涉及到的组件要在启动中全部就绪，每个组件都需要一些资源或依赖，并且是有状态的，在关闭时全部销毁或释放。

Tomcat作为Web服务器，不仅需要支持虚拟主机实现多个网站，还要能部署多个应用，每个应用包含多个Servlet处理不同的实际完整请求。

因为HTTP协议是无状态，而Web应用需要状态标识请求是否来自同一个客户端。

I/O模型：NIO、NIO.2、APR(C/C++实现)，应用层协议：HTTP/1.1、AJP、HTTP/2

Java 在JDK1.4之前只有BIO，然后，1.4增加了NIO，7增加了NIO.2，当前版本已经去掉了BIO，默认支持NIO。

HTTP/1.1版本虽然存在了很多年，但不代表没有升级版本，即HTTP/2。

WebSocket 规范也是后续新增。

整体架构要可扩展、可伸缩，才能应对上述及以外各方面的变更。

----