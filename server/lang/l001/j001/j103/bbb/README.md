#   JDBC

JDBC API 是一种 Java API，用于访问几乎任何类型的表格数据，由一组用 Java 编写的类和接口组成。

JDBC API 是 Java 语言与各种数据库之间无关连接的行业标准。

JDBC API 是一种执行SQL语句的API，JDBC 驱动才是真正的接口实现，所有的网络逻辑和特定于数据库的通信协议都隐藏和独立于供应商的JDBC API后面。

sun 公司只是提供 JDBC API，每个数据库厂商都有自己的驱动来连接自己家的数据库。

-   [JDBC驱动](https://www.processon.com/view/link/5e801456e4b03b99653ded51)

JDBC API 采用了桥接的设计模式，提供了两套接口，JDBC  Driver Planager 面向数据库厂商，如 Oracle、MySQL等； JDBC API 面向 JDBC 使用者，如 Java 应用。

##  背景

JDBC  为工具/数据库开发人员提供标准API的编程语言，可以使用全Java API 编写工业级数据库应用程序。

Java运行时包含的数据对象，都是放在内存中，当程序关闭重启时，这些数据就没有了，这自然是不可以！

- 出现原因

需要一种方法，在重新运行时能够把关闭前的数据对象给找回来，这就是持久化，把数据放在硬盘上面，就是操作系统重启也没关系。

另外，程序运行时内存毕竟是有限的，而数据对象不知道有多少，全都放在内存也不合适，运行时需要的数据在内存中就可以了。

- 主要优势

数据库是专门存储数据，把这些数据对象放在数据库里面。然后，就需要一个接口，让Java程序能够连接数据库服务器，这就是 JDBC 库，他是面向关系型数据库，如：[MySql](https://www.mysql.com/)、[PostgreSQL](https://www.postgresql.org/) 等。

通过JDBC，Java程序在重启之后，还可以恢复原来的数据对象状态。

----

##  主要问题

需要搭建运行环境，依赖外部中间件，存在网络通信

数据库服务器需要专门管理，情况变得有些复杂

----

##  解决方案

>   使用 MySql 作为数据库服务器

从Java的角度看，MySql是一个存放数据的地方。

从MySql的角度看，Java是一种客户端，使用部分功能

### 搭建运行环境

1.  MySql 服务器

本地安装或云上运行的 MySql 服务器

使用某种MySql服务器的客户端连接，并且成功

2.  下载 Java版的MySql驱动包加入项目

3.  记录连接MySql服务器时使用的信息：地址、端口、用户名和密码

客户端连接MySql服务器的信息同样在 Java 里需要。

### JDBC 主要特点

-   JDBC操作是从数据库连接开始，然后才能进行各种操作
-   JDBC操作流程是固定，具备模板模式
-   JDBC主要操作分类
    -   执行SQL语句
    -   获取数据库元数据

对于主要操作，可以通过接口屏蔽掉，定义一个对象把数据库连接和对应的操作给封装起来，暴露出来的可能就是一个个方法，这些方法表明了它的操作具备的功能。

数据库服务器接收可执行SQL语句，然后返回响应数据。

执行SQL语句操作，需要请求参数、原始SQL语句、响应对象，这是变化部分，可以使用一个对象包装起来。执行SQL语句，根据请求参数加上传入的原始SQL得到，响应数据是根据操作确定，从JDBC对象到自定义数据类，需要转换。

可以通过动态代理，把各种业务操作调用重定向到JDBC语法方法，也就回到了JDBC操作流程上来了。

### 数据库事务

数据库事务是由数据库服务器支持实现的，向客户端提供接口。

在JDBC里，事务是与连接一起，只有提交了事务，执行的SQL语句才会起作用，SQL语句数据执行即读写，对应到SQL语句操作，读只有查询，写有新增、删除、修改三个操作。

不知道，事务与连接是不是一对一的关系，不过，好像没有关系，事务是逻辑上的，连接是物理上的，也许一个连接可以发送多个事务。

这个连接是建立在TCP网络请求上的，那么提交事务是不是就是使用TCP向服务器发送数据了？

事务执行主要有三个阶段：执行之前、执行期间、执行之后，执行结果只有两个：成功、失败，成功了就把数据变更并且不可逆，失败就回复原状，什么都没发生过。

事务里可以包含多条SQL语句，但是他们是一个整体，不可分割，一个执行单元，也就是原子性。

事务执行成功之后，即使发生异常，数据也不会变化，这就是持久性。

为了对应多个请求同时读写数据，需要一种方法来应对这种并发，这就是隔离性，看起来很像并发里的安全性问题，写改变共享数据，读到的数据，可能不具备时效性。查询操作在写处理之前，这时数据变化了；查询操作在写处理之后但是事务失败了，这时数据就不准确了。

数据从当前状态到另外状态也要保持一致，这就是一致性。

事务开启，表示后面添加的SQL是这个执行单元一部分，事务提交，表示后续没有SQL语句提交了，从开启到提交期间出现的SQL语句就是此次的任务作业。不过，这个过程中还可以开启子事务，也就是嵌套事务，父事务和子事务是否是一个大的事务呢？或者说互不影响，或者说子事务影响父事务？

在JDBC里能够体现事务的也就是设置连接的属性和连接的提交方法。

----

##  设计实现

-   [JDBC 语法](https://www.processon.com/view/link/5e52131ee4b0cc44b5a6d8cf)

----

##  应用模式

-   [JDBC 流程](https://www.processon.com/view/link/5dc8c8fbe4b07548229edd7e)

-   Java对象属性与数据库表列字段相互映射
-   存入数据库时，使用Java对象属性值拼接SQL语句，发送给数据库执行
-   读取数据库时，使用查询SQL语句，解析响应结果，初始化Java对象
-   Java对象名称一般对应数据库表名
-   Java对象属性名称一般对应数据库表列字段
-   Java对象属性类型与数据库表列字段可能不匹配

----

##  典型案例
-   [MyBatis](https://github.com/kaoshanji/learning/tree/master/server/lang/l001/j004/mybatis)
-   Hikaricp/Druid
-   Spring MVC
-   Hibernate

----

