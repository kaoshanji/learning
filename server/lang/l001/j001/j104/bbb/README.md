#   Java I/O

I/O 系统主要是用来解决计算机系统里通信的问题，Java I/O 实现包括：I/O、Net、NIO、NIO.2。

##  背景

计算机系统里通信是人机、机器之间交换数据的方法，数据只有交互才能产生价值。

-   字节

存储单位：bit/比特/位(0101) * 8/n --> Byte/字节 * 1024 --> KB * 1024 --> MB * 1024 --> GB * 1024 -->  TB

bit 是计算机最小的单位，大部分使用 8位的块即字节作为基本单位。

----

##  主要问题

输入/输出，数据`源端`类型有很多，处理`过程`方式有很多，`接收`类型也有很多。

-   [编程里的输入/输出](http://assets.processon.com/chart_image/5de475dae4b0d1f8f2c71681.png)

速度要不断的提高，针对的场景却越来越具体化。

网络传输或文件系统读写都是以`字节`为单位，但是，程序里更多的是Java对象或基本数据类型等，这样就需要转换，也就是编码和解码，解释成字符，就需要字符编码。

----

##  解决方案

-   对 UNIX 网络编程 I/O 模型一点认识
-   Java IO相关JCP
    -   [新I/O](https://jcp.org/en/jsr/detail?id=51)
    -   [NIO.2](https://jcp.org/en/jsr/detail?id=203)
    -   [Unicode](https://jcp.org/en/jsr/detail?id=204)

把外部设备的数据写入到 JVM 叫输入，把 JVM 里的数据读取到外部设备叫输出，这是在堆内操作。

数据可以不被读取到 JVM 而直接在 OS 内存里处理，是堆外内存，由 OS 操作。

-   Java I/O 抽象出来的对象：流和通道，流可以操作数据，通道建立连接
-   Java I/O 具体操作的对象：文件及套接字，Linux系统里套接字被当做一种文件类型对待 
-   Java I/O 三种模式的术语：同步与异步、阻塞与非阻塞

流可以操作文件系统和套接字，是同步阻塞的，朴实基础，针对一个字节一个字节操作(可以添加缓冲)，与操作系统交互需要转换，效率较低。

通道可以建立与文件系统和套接字的连接，可以是同步非阻塞(阻塞)或异步，借助缓冲器，可以一块一块的操作数据，更符合操作系统模式，效率较高。

Java I/O 系统主要分为 3 个部分：文件内容、访问文件和文件存储：

-   文件内容，面向数据。一般步骤，首先建立连接(源端和接收)，再进行读/写操作，可以根据特定场景添加特性提高便捷性
    -   对于文件和套接字，建立连接有同步或异步两种模式，读/写操作也是一样，实际操作的格式都是字节
    -   建立连接，文件使用路径，套接字使用IP地址
    -   读/写操作，流直接使用字节，通道借助缓冲器
    -   文件读取支持同步阻塞和异步操作
    -   套接字支持同步阻塞、同步非阻塞多路可复用、异步操作，但是还是会呈现建立连接、读、写，只是实现模式不同
-   访问文件，获取文件属性信息，搜寻文件
    -   文件路径，表示文件所处的位置
    -   目录流/遍历文件，某个文件夹下搜索文件，或把文件元素成树型展现
    -   文件链接，处理文件快捷键，或指引，找到文件
    -   属性视图，文件元信息、权限属性等
-   文件存储，文件系统是放在磁盘上面数据的抽象
    -   文件系统，对 I/O 操作进行支持
    -   文件操作，最常见的对文件创建、删除、复制、移动
    -   监视文件，某个目录下文件变动发出通知

----

##  设计实现

这么多的类接口都是为了解决一个问题：I/O，主要分为两类，数据传输的`方式`(文件/网络)和传输数据的`格式`(字节/字符)，然后，针对特定场景进行优化(Java I/O 模式：BIO/NIO/AIO)，时间就是金钱。

### 梳理 Java I/O API

API 规范，概要介绍一下 API 包。

-   [Java I/O `导图`](https://www.processon.com/view/link/5e52272fe4b07f2b831eed43)
-   [Java NIO `导图`](https://www.processon.com/view/link/5e522760e4b0d4dc876904a1)
-   [Java I/O-net `导图`](https://www.processon.com/view/link/5e52274ae4b07f2b831eed6e)
-   [API 的三次更新](100x.md)
-   [Java I/O, NIO, and NIO.2](101x.md)
-   [Java Net](102x.md)

----

##  应用模式


### Java 网络编程模板

描述主要步骤+代码，完整代码在 ../jdkx.io.template 包下，代码仅做示例感受一下

主要的逻辑，客户端发送"服务端你好，我是客户端A，请告诉我当前时间."，服务端响应："客户端好，现在服务端的时间是：xxx"，其他全部都是套路模板代码，如同JDBC、Servlet一样。

-   套接字通信
    -   单播通信(TCP)：一对一的通信模式，发送、接收信息发生在两个端点之间，最为常见，数据可靠
    -   组播通信(UDP)：一对多的通信模式，可以将一份数据发送到组内的多个端点，在公网上传播，数据不可靠
    -   广播通信(UDP)：一对多的通信模式，重点在于广，向路由器连接的所有主机都发送消息不管主机是否需要，在局域网内传播，数据不可靠
-   Java  BIO/NIO/AIO 网络代码流程
    -   [Java BIO 网络代码流程](210x.md)
    -   [Java NIO 网络代码流程](220x.md)
    -   [Java AIO 网络代码流程](230x.md)
    -   多线程非阻塞I/O模型：Reactor模式
-   参考应用实践
    -   [Netty](https://netty.io/)
    -   [Tomcat](http://tomcat.apache.org/)


### Java API 功能示例

// 原理可能在操作系统接口实现里，需要理解 JVM，可能使用本地代码写的，读一下 JVM 源码大概就能理解吧


----

##  典型案例

-   [RFC](https://www.ietf.org/)：协议标准化文档
-   HTTP客户端
    -   [okhttp](https://square.github.io/okhttp/)
    -   [HttpComponents](http://hc.apache.org/)
-   文件操作
    -   [lucene](https://lucene.apache.org/)

----