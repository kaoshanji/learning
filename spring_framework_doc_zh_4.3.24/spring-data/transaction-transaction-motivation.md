# 17.2 spring事务的好处

传统上，Java EE开发人员有两种交易管理选择： *全局*或*本地*交易，这两种交易都有很大的局限性。在接下来的两节中将对全局和本地事务管理进行审查，然后讨论Spring Framework的事务管理支持如何解决全局和本地事务模型的局限性。

### 17.2.1 Global transactions

全局事务使您可以使用多个事务资源，通常是关系数据库和消息队列。应用程序服务器通过JTA管理全局事务，这是一个使用繁琐的API（部分原因是它的异常模型）。此外，JTA `UserTransaction`通常需要从JNDI获取，这意味着您*还*需要使用JNDI才能使用JTA。显然，全局事务的使用将限制应用程序代码的任何潜在重用，因为JTA通常仅在应用程序服务器环境中可用。

以前，使用全局事务的首选方法是通过EJB *CMT* （*容器管理事务*）：CMT是一种*声明式事务管理*（与*程序化事务管理不同）*）。EJB CMT消除了与事务相关的JNDI查找的需要，尽管EJB本身的使用当然需要使用JNDI。它消除了编写Java代码以控制事务的大部分但不是全部的需要。重要的缺点是CMT与JTA和应用服务器环境相关联。此外，仅当选择在EJB中实现业务逻辑时，或者至少在事务性EJB外观之后，它才可用。一般来说，EJB的负面影响是如此之大，以至于这不是一个有吸引力的主张，特别是面对声明式事务管理的令人信服的替代方案。

### 17.2.2 Local transactions

本地事务是特定于资源的，例如与JDBC连接关联的事务。本地事务可能更容易使用，但具有明显的缺点：它们无法跨多个事务资源工作。例如，使用JDBC连接管理事务的代码无法在全局JTA事务中运行。由于应用程序服务器不参与事务管理，因此无法确保跨多个资源的正确性。（值得注意的是，大多数应用程序使用单个事务资源。）另一个缺点是本地事务对编程模型是侵入性的。

### 17.2.3 Spring Framework的一致编程模型

Spring解决了全局和本地事务的缺点。它使应用程序开发人员能够*在任何环境中*使用*一致的*编程模型。您只需编写一次代码，就可以从不同环境中的不同事务管理策略中受益。Spring Framework提供了声明式和编程式事务管理。大多数用户更喜欢声明式事务管理，在大多数情况下建议使用。

通过编程式事务管理，开发人员可以使用Spring Framework事务抽象，它可以在任何底层事务基础结构上运行。使用首选的声明性模型，开发人员通常很少或根本不编写与事务管理相关的代码，因此不依赖于Spring Framework事务API或任何其他事务API。

**您是否需要应用程序服务器进行事务管理？**

Spring Framework的事务管理支持改变了关于企业Java应用程序何时需要应用程序服务器的传统规则。

特别是，您不需要仅通过EJB进行声明式事务的应用程序服务器。实际上，即使您的应用程序服务器具有强大的JTA功能，您也可以决定Spring Framework的声明式事务提供比EJB CMT更强大的功能和更高效的编程模型。

通常，只有当您的应用程序需要处理跨多个资源的事务时，您才需要应用程序服务器的JTA功能，这对许多应用程序来说并不是必需的。许多高端应用程序使用单个高度可伸缩的数据库（例如Oracle RAC）。独立的事务管理器，如 [Atomikos Transactions](https://www.atomikos.com/)和[JOTM，](http://jotm.objectweb.org/) 是其他选项。当然，您可能需要其他应用程序服务器功能，例如Java消息服务（JMS）和Java EE连接器体系结构（JCA）。

Spring Framework *使您可以选择何时将应用程序扩展到完全加载的应用程序服务器*。使用EJB CMT或JTA的唯一替代方法是使用本地事务（例如JDBC连接上的代码）编写代码，并且如果您需要在全局容器管理的事务中运行代码，则会面临大量的返工。使用Spring Framework，只需要更改配置文件中的一些bean定义，而不是代码。